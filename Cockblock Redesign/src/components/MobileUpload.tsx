import { useState, useRef } from 'react';
import svgPaths from "../imports/svg-txj0xpkrdi";
import svgPathsCapture from "../imports/svg-gqwqc58oze";
import svgPathsSlider from "../imports/svg-5gbi202qd2";
import imgLayer13 from "figma:asset/36d9fe07331ccf7be2d5e9237678fb5d241d9d02.png";
import imgLayer19 from "figma:asset/5b7c55f37a4981d824bc9fc616e1ef217cc6f4f6.png";
import imgLayer1 from "figma:asset/b5c2e74efdab52af47376e489b7838649674699a.png";
import imgImage42 from "figma:asset/2f77cbe2106a3ddf767c538aec975c1e336500c5.png";
import imgMobileMenu2 from "figma:asset/670723166d639047fb41ad1eb337f56fbef65772.png";
import imgGroup2331 from "figma:asset/e2fa7924faadaab3b607786dd00b91529258b98e.png";

function Group2({ className, onClick }: { className?: string; onClick?: () => void }) {
  return (
    <div className={className} onClick={onClick}>
      <div className="absolute bg-[#ff001b] inset-0 rounded-[20px]">
        <div aria-hidden="true" className="absolute border-[#401b01] border-[3px] border-dashed inset-0 pointer-events-none rounded-[20px]" />
      </div>
      <div className="absolute bottom-[0.73%] contents font-['Archivo_Narrow:Bold',sans-serif] font-bold leading-[0] left-[1.38%] right-0 text-[#401b01] text-[22px] top-[0.81%] tracking-[2.2px]">
        <div className="absolute flex flex-col inset-[0.81%_40.34%_72.28%_1.38%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[18.7%_40.34%_54.39%_1.38%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[36.59%_40.34%_36.5%_1.38%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[54.47%_40.34%_18.62%_1.38%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[72.36%_40.34%_0.73%_1.38%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[0.81%_2.06%_72.28%_39.66%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[18.7%_2.06%_54.39%_39.66%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[36.59%_2.06%_36.5%_39.66%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[54.47%_2.06%_18.62%_39.66%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute flex flex-col inset-[72.36%_2.06%_0.73%_39.66%] justify-center">
          <p className="leading-[normal]">CAPTURE</p>
        </div>
        <div className="absolute bottom-[72.32%] flex flex-col justify-center left-[77.93%] right-0 top-[0.85%]">
          <p className="leading-[normal]">CAPT</p>
        </div>
        <div className="absolute bottom-[54.43%] flex flex-col justify-center left-[77.93%] right-0 top-[18.74%]">
          <p className="leading-[normal]">CAPT</p>
        </div>
        <div className="absolute bottom-[36.55%] flex flex-col justify-center left-[77.93%] right-0 top-[36.63%]">
          <p className="leading-[normal]">CAPT</p>
        </div>
        <div className="absolute bottom-[18.66%] flex flex-col justify-center left-[77.93%] right-0 top-[54.51%]">
          <p className="leading-[normal]">CAPT</p>
        </div>
        <div className="absolute bottom-[0.77%] flex flex-col justify-center left-[77.93%] right-0 top-[72.4%]">
          <p className="leading-[normal]">CAPT</p>
        </div>
      </div>
      <div className="absolute bg-[magenta] inset-[9.76%_70.34%_9.76%_4.14%] rounded-[12px]" />
      <div className="absolute inset-[42.28%_79.02%_41.87%_12.76%]">
        <div className="absolute inset-[-5.13%_-4.2%]">
          <svg className="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 26 22">
            <g id="Group 58062">
              <path d={svgPathsCapture.p2fbd6600} id="Vector" stroke="var(--stroke-0, white)" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" />
              <path d={svgPathsCapture.p66e7680} id="Vector_2" stroke="var(--stroke-0, white)" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" />
            </g>
          </svg>
        </div>
      </div>
    </div>
  );
}

function Group1({ className, onClick }: { className?: string; onClick?: () => void }) {
  return (
    <div className={className} onClick={onClick}>
      <div className="absolute bg-[#ff85ff] inset-0 rounded-[20px]">
        <div aria-hidden="true" className="absolute border-[#401b01] border-[3px] border-dashed inset-0 pointer-events-none rounded-[20px]" />
      </div>
      <div className="absolute bottom-[2.36%] contents font-['Archivo_Narrow:Bold',sans-serif] font-bold leading-[0] left-[1.38%] right-0 text-[#401b01] text-[22px] top-[2.44%] tracking-[2.2px]">
        <div className="absolute flex flex-col inset-[2.44%_40.34%_70.65%_1.38%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[19.51%_40.34%_53.58%_1.38%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[36.59%_40.34%_36.5%_1.38%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[53.66%_40.34%_19.43%_1.38%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[70.73%_40.34%_2.36%_1.38%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[2.44%_6.54%_70.65%_35.17%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[19.51%_6.54%_53.58%_35.17%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[36.59%_6.54%_36.5%_35.17%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[53.66%_6.54%_19.43%_35.17%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute flex flex-col inset-[70.73%_6.54%_2.36%_35.17%] justify-center">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute bottom-[70.73%] flex flex-col justify-center left-[68.97%] right-0 top-[2.44%]">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute bottom-[53.66%] flex flex-col justify-center left-[68.97%] right-0 top-[19.51%]">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute bottom-[36.59%] flex flex-col justify-center left-[68.97%] right-0 top-[36.59%]">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute bottom-[19.51%] flex flex-col justify-center left-[68.97%] right-0 top-[53.66%]">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
        <div className="absolute bottom-[2.44%] flex flex-col justify-center left-[68.97%] right-0 top-[70.73%]">
          <p className="leading-[normal]">UPLOAD</p>
        </div>
      </div>
      <div className="absolute bg-[#ff001b] inset-[9.76%_70.34%_9.76%_4.14%] rounded-[12px]" />
      <div className="absolute inset-[42.28%_79.46%_41.93%_13.45%]">
        <div className="absolute inset-[-5.15%_-4.86%]">
          <svg className="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 23 22">
            <g id="Group 58062">
              <path d="M11.2852 1L11.2829 14.7143" id="Line 16" stroke="var(--stroke-0, #401B01)" strokeLinecap="round" strokeWidth="2" />
              <path d={svgPaths.p3d09e680} id="Vector" stroke="var(--stroke-0, #401B01)" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" />
              <path d={svgPaths.p1d281d80} id="Rectangle 4771" stroke="var(--stroke-0, #401B01)" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" />
            </g>
          </svg>
        </div>
      </div>
    </div>
  );
}

function Component({ className }: { className?: string }) {
  return (
    <div className={className} data-name="Component 1">
      <div className="absolute aspect-[994/994] left-0 right-[57.07%] top-[55px]" data-name="Layer_1-3">
        <img alt="" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgLayer13} />
      </div>
      <div className="absolute aspect-[236.376/236.376] flex items-center justify-center left-[36.18%] right-0 top-[48px]">
        <div className="flex-none rotate-[15deg] size-[193px]">
          <div className="relative size-full" data-name="Layer_1-9">
            <img alt="" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgLayer19} />
          </div>
        </div>
      </div>
      <div className="absolute aspect-[615/567] left-[34.83%] right-[25.75%] top-0" data-name="Layer_1">
        <img alt="" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgLayer1} />
      </div>
      <div className="absolute aspect-[867/632] left-[7.83%] right-[41.41%] top-[155px]" data-name="image 42">
        <img alt="" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgImage42} />
      </div>
    </div>
  );
}

function Arrow() {
  return (
    <div className="h-[8px] relative shrink-0 w-[10.25px]" data-name="arrow">
      <div className="absolute inset-[-9.38%_-7.32%]">
        <svg className="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 12 10">
          <g id="arrow">
            <path d="M0.75 4.75L9.25 4.75" id="Line" stroke="var(--stroke-0, white)" strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" />
            <path d={svgPaths.p307f5c00} id="<" stroke="var(--stroke-0, white)" strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" />
          </g>
        </svg>
      </div>
    </div>
  );
}

function Group({ onClick }: { onClick?: () => void }) {
  return null;
}

function Group3({ scrollProgress }: { scrollProgress: number }) {
  return (
    <div className="absolute bottom-[11.33%] left-[calc(50%-0.5px)] top-[86.27%] translate-x-[-50%] w-[297px] pointer-events-none">
      <svg className="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 297 21">
        <g id="Group 58080">
          <path d={svgPathsSlider.p4188e00} fill="var(--fill-0, #FF001B)" fillOpacity="0.5" id="Vector" />
          <path 
            d={svgPathsSlider.p2faedc0} 
            fill="var(--fill-0, #FF001B)" 
            id="Vector_2"
            style={{
              opacity: 1 - scrollProgress,
              transition: 'opacity 0.1s ease-out'
            }}
          />
          <path 
            d={svgPathsCapture.pdbca7b0} 
            fill="var(--fill-0, #FF001B)" 
            id="Vector_3"
            style={{
              opacity: scrollProgress,
              transition: 'opacity 0.1s ease-out'
            }}
          />
        </g>
      </svg>
    </div>
  );
}

interface MobileUploadProps {
  onNavigate: (page: 'use' | 'merch' | 'info' | 'customise') => void;
  onToggleMenu: () => void;
  menuExpanded?: boolean;
  onImageUpload?: (imageDataUrl: string) => void;
}

export default function MobileUpload({ onNavigate, onToggleMenu, menuExpanded = true, onImageUpload }: MobileUploadProps) {
  const [scrollProgress, setScrollProgress] = useState(0);
  const containerRef = useRef<HTMLDivElement>(null);
  const uploadInputRef = useRef<HTMLInputElement>(null);
  const captureInputRef = useRef<HTMLInputElement>(null);

  const handleScroll = (e: React.UIEvent<HTMLDivElement>) => {
    const target = e.currentTarget;
    const scrollLeft = target.scrollLeft;
    const maxScroll = target.scrollWidth - target.clientWidth;
    
    const progress = maxScroll > 0 ? scrollLeft / maxScroll : 0;
    setScrollProgress(progress);
  };

  const handleUploadClick = () => {
    uploadInputRef.current?.click();
  };

  const handleCaptureClick = () => {
    captureInputRef.current?.click();
  };

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      console.log('Selected file:', file);
      // Convert file to data URL and pass to parent
      const reader = new FileReader();
      reader.onloadend = () => {
        const result = reader.result as string;
        if (onImageUpload) {
          onImageUpload(result);
        }
        // Navigate to customise screen
        onNavigate('customise');
      };
      reader.readAsDataURL(file);
    }
  };

  return (
    <div 
      className="bg-[#291a01] relative size-full overflow-hidden" 
      data-name="mobile-upload-2"
    >
      {menuExpanded ? (
        <>
          <div className="absolute h-[54px] left-[calc(50%+0.5px)] top-[32px] translate-x-[-50%] w-[349px] cursor-pointer z-10" data-name="mobile-menu 2" onClick={onToggleMenu}>
            <img alt="" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgMobileMenu2} />
          </div>
          <div className="absolute flex flex-col font-['Archivo_Narrow:Bold',sans-serif] font-bold h-[47px] justify-center leading-[0] left-[173.5px] text-[#401b01] text-[12px] text-center top-[58.5px] translate-x-[-50%] translate-y-[-50%] w-[49px] cursor-pointer z-10" onClick={() => onNavigate('use')}>
            <p className="leading-[normal]">USE</p>
          </div>
          <div className="absolute flex flex-col font-['Archivo_Narrow:Bold',sans-serif] font-bold h-[47px] justify-center leading-[0] left-[243.5px] text-[#401b01] text-[12px] text-center top-[58.5px] translate-x-[-50%] translate-y-[-50%] w-[49px] cursor-pointer z-10" onClick={() => onNavigate('merch')}>
            <p className="leading-[normal]">MERCH</p>
          </div>
          <div className="absolute flex flex-col font-['Archivo_Narrow:Bold',sans-serif] font-bold h-[47px] justify-center leading-[0] left-[313.5px] text-[#401b01] text-[12px] text-center top-[58.5px] translate-x-[-50%] translate-y-[-50%] w-[49px] cursor-pointer z-10" onClick={() => onNavigate('info')}>
            <p className="leading-[normal]">INFO</p>
          </div>
        </>
      ) : (
        <div className="absolute h-[50px] left-[37px] top-[32px] w-[115px] cursor-pointer z-10" data-name="Group 233 1" onClick={onToggleMenu}>
          <img alt="" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgGroup2331} />
        </div>
      )}
      <Component className="absolute h-[292px] left-[17px] top-[116px] w-[370.376px] z-10" />
      <div className="absolute flex flex-col font-['Archivo_Narrow:Bold',sans-serif] font-bold justify-end leading-[0] left-[201.5px] text-[38px] text-center text-white top-[521px] tracking-[-0.76px] translate-x-[-50%] translate-y-[-100%] w-[291px] z-10">
        <p className="leading-none">Upload an Image</p>
      </div>
      <Group onClick={() => onNavigate('info')} />
      
      {/* Scrollable container for cards only */}
      <div 
        ref={containerRef}
        onScroll={handleScroll}
        className="absolute h-[123px] left-0 overflow-x-auto overflow-y-hidden right-0 scrollbar-hide top-[584px]"
      >
        <div className="relative h-full" style={{ width: '700px' }}>
          <Group1 className="absolute h-[123px] left-[196.5px] top-0 translate-x-[-50%] w-[290px] cursor-pointer" onClick={handleUploadClick} />
          <Group2 className="absolute h-[123px] left-[504.5px] top-0 translate-x-[-50%] w-[290px] cursor-pointer" onClick={handleCaptureClick} />
        </div>
      </div>
      
      <Group3 scrollProgress={scrollProgress} />
      
      {/* Hidden file inputs */}
      <input
        ref={uploadInputRef}
        type="file"
        accept="image/*"
        onChange={handleFileSelect}
        className="hidden"
      />
      <input
        ref={captureInputRef}
        type="file"
        accept="image/*"
        capture="environment"
        onChange={handleFileSelect}
        className="hidden"
      />
    </div>
  );
}
